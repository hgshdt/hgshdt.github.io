{"pageProps":{"tagPosts":[{"slug":"github-actions","data":{"title":"Deploy a Next.js app to GitHub pages with GitHub Actions","excerpt":"","image":"","isFeatured":true,"date":"2021-07-28","tags":["Next.js","GitHub"]},"content":"\nThis article is how to deploy a static Next.js app to GitHub Pages with GitHub Actions. The Next.js app is a private repository, so I use a `repository _dispatch` event for deployment.\n\n## Create public repository for GitHub Pages\n\nCreate `<username>.github.io` as a public repository.\n\n## Create a personal access token\n\nSelect the `repo` scopes and generate a token, create a repository secret named `MY_GITHUB_TOKEN` for each repository and set the generated token to value.\n\n## Create a workflow of dispatch trigger (in private repository)\n\nCreate `.github/workflows/dispatch.yml`. A push event to a private repository triggers an action in the public repository.\n\n```yml:dispatch.yml\nname: 'Dispatch trigger'\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  dispatch-trigger:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Dispatch trigger\n        uses: peter-evans/repository-dispatch@v1\n        with:\n          repository: <username>/<username>.github.io\n          token: ${{ secrets.MY_GITHUB_TOKEN }}\n          event-type: sync\n```\n\n## Create a workflow of build and deployment (in public repository)\n\nCreate `.github/workflows/gh-pages.yml`. An action from the private repository executes build (`next build && next export`) and deployment jobs.\n\n```yml:gh-pages.yml\nname: GitHub Pages\n\non:\n  repository_dispatch:\n    types: [sync]\n\njobs:\n  build-deploy:\n    runs-on: ubuntu-latest\n    env:\n      FROM_REPO_USER: <username>\n      FROM_REPO_NAME: <private-repository-name>\n    steps:\n      - uses: actions/checkout@v2\n        with:\n          repository: ${{ env.FROM_REPO_USER }}/${{ env.FROM_REPO_NAME }}\n          token: ${{ secrets.MY_GITHUB_TOKEN }}\n          ref: main\n          path: ./From\n      - name: Setup Node\n        uses: actions/setup-node@v2\n        with:\n          node-version: '14'\n      - name: Install\n        working-directory: ./From\n        run: npm install\n      - name: Build\n        working-directory: ./From\n        run: |\n          npm run build\n          touch out/.nojekyll\n      - name: Deploy\n        uses: peaceiris/actions-gh-pages@v3\n        with:\n          github_token: ${{ secrets.GITHUB_TOKEN }}\n          publish_dir: ./From/out\n```\n"}],"tag":"GitHub"},"__N_SSG":true}